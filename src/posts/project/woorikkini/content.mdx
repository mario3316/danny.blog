---
title: 우리끼니
description: 혼자 밥먹는 1인 가구 세대를 위한 “함께 밥 먹는 웹 화상채팅 서비스"
startDate: 2023-01-09
endDate: 2023-02-17
techstacks: React.js, Redux, OpenVidu, Styled-components
url: https://github.com/swhana/woorikkini
thumbnail: /project/woorikkini/woorikkini_thumbnail.gif
---

## 맡은 역할

### 공통
    - React-redux를 사용하여 여러 컴포넌트가 같은 state를 공유하게 함으로써 props drilling을 최소화하였습니다.
    - 또한 같은 기능을 가진 함수들을 모듈화하여 코드의 유지보수성과 재사용성을 끌어올렸습니다.

### 회원인증 기능 구현
    - 서비스 특성상 회원만 볼 수 있는 페이지가 필요했기 때문에, 토큰 보유 여부로 사용자의 로그인 상태를 파악하고 react-router를 사용하여 라우팅을 분리하였습니다.
    - 인증받은 사용자 클라이언트에 발급된 토큰을 저장하는 방식을 사용하였습니다.

### 로그인 / 로그아웃 / 회원탈퇴 페이지 구현

### OpenVidu 라이브러리를 활용한 실시간 화상채팅 서비스 기능 구현
    - 참여자목록
    - 실시간 채팅
    - 강퇴 투표

## 기술스택 도입 이유

- `Vue3` 가 업데이트 된지 오래되지 않아, 상대적으로 레퍼런스와 학습 자료가 풍부한 `React` 를 도입하기로 했습니다. `Vue2` 로 개발하자는 팀원의 의견도 있었지만, 새로운 것에 도전해보고 싶다는 생각에 팀원들을 설득해 `React` 를 최종적으로 선택했습니다.
- `OpenVidu` 는 WebRTC 기술을 활용한 오픈소스 라이브러리입니다. WebRTC 기술을 원천적으로 이해하고 구현하는 것은 일정 내에는 힘들다고 판단해 가장 러닝커브가 낮다고 알려진 `OpenVidu` 라이브러리를 활용하는 것으로 결정했습니다.
- SPA 개발을 진행하다보면 전역상태 관리가 필수적이었고, Context API만으로는 힘들다고 판단했기 때문에 `Redux` 를 도입했습니다. 물론 관련자료를 찾아볼 때 `Redux`를 가장 많이 사용한 점도 선택이유로 작용했습니다.

## 문제 해결

### 로그인 시에 회원정보를 전역 상태로 관리하던 중, 새로고침하면 상태가 초기화되어 로그인이 풀리는 문제
    - github에 무작정 react를 포함한 키워드로 프로젝트를 검색해 소스코드를 읽어보려고 하였음
    - google은 물론이고 이때는 react 책을 끼고 살았는데 여기선 redux-persist를 사용하는것을 추천했다
    - 로컬스토리지에 토큰과 유저 ID, 닉네임을 저장하는 것으로 해결
    - 보안을 고려해서 리프레시 토큰은 노출시키지 않았음
    
### OpenVidu(WebRTC 오픈소스 라이브러리) 관련 문제
    - 처음엔 WebRTC의 개념부터 배워야겠다 생각해서 공식문서부터 읽으려 했으나, 직접 WebRTC를 구현하는 것도 아니고 일정에 맞추지 못할 것 같아서 기본 개념만 이해하고 OpenVidu 공식문서를 계속해서 찾아보면서 개발을 진행했다
    - 화상채팅방 세션을 생성하면 방 목록에 방이 생성되고, 다른 사용자가 해당 방을 클릭해 세션에 접속하도록 하는 것이 가장 핵심 기능이었는데 구현에 상당히 애를 먹었다.
    - OpenVidu의 경우 구글을 찾아봐도 이해하기 쉽게 정리한 자료가 상당히 부족했다. 이 역시 github에 openvidu를 쳐서 나오는 프로젝트 소스코드를 뜯어보면서 이해하려고 노력했다.
    - 이때 세션 접속하는 방법이 이해가 잘 안되서 OpenVidu를 다루는 다른 팀에 찾아가서 물어보기도 했다.
    - OpenVidu 공식사이트에서 제공하는 예제코드들이 있었기 때문에 그걸 한줄씩 해독하면서 개발을 진행했다.
    - 결과적으로는 먼저 방 생성 요청을 백엔드 서버에 하고, response로 해당 방의 ID를 받아 그것으로 OpenVidu 서버에 세션 생성 요청을 했다. 같은 방의 ID로 세션을 만들고 그것으로 다시 토큰을 발급받으면 같은 세션으로 들어올 수 있다는 것을 확인했다.

### 실시간 채팅, 강퇴 투표 기능 구현
    - 일반적으로는 소켓통신을 사용해서 구현할텐데, OpenVidu 자체에서 실시간 채팅기능을 지원한다는 것을 공식문서를 찾다가 발견했다.
    - 세션에서 채팅 이벤트를 발생시키고, 이를 다른 사용자가 감지하는 방식으로 이루어지는 듯 했다. 채팅 자체는 이미 구현된 예제 코드를 바탕으로 생각보다 쉽게 구현할 수 있었다.
    - 이를 응용하면 강퇴 투표 기능도 구현할 수 있으리라 생각했다. 찬성/반대 투표나 투표시작 같은 액션을 이벤트로 처리하고 이를 각각의 유저가 수신해 투표결과를 집계하면 되지않을까 생각했다.
    - 각 유저의 찬성/반대 표를 각각의 클라이언트에서 각자 집계하고 처리해야했다. 추방 이벤트도 유저 수만큼 발생했다. 이미 추방된 유저가 계속 추방되었다고 메시지가 뜨기도 했다.
    - 프로젝트 시연이 얼마 남지 않은 상황이었기 때문에 방식을 갈아엎기는 힘들었다. 투표를 시작한 유저를 기억하고 해당 유저가 최종 집계를 해 추방 처리를 하는 방식을 통해 중복 강퇴되는 현상은 어찌저찌 막을 수 있었다.
    - 강퇴당한 유저는 자동으로 세션을 떠나는 처리를 통해 강퇴기능을 구현했는데, 이 세션을 떠나는 처리가 신속하지 못했다. 새로고침을 해야 해당 유저가 사라졌기 때문에 결국 시연 당시에는 추방 투표가 끝나고 새로고침해서 유저가 사라진 모습을 보여주는 식으로 마무리했다.

### React 학습 당시 발생한 문제
    - 처음 배울 때는 책으로 배우는게 좋겠다 생각해서 “리액트를 다루는 기술” 책으로 학습을 시작했는데, 책에서의 예제가 오류가 생기곤 했다
    - React와 react-router-dom이 각각 v18과 v6로 업데이트 되면서 deprecated된 메서드들이 생긴 것이 원인이었다
    - 팀원들도 다 나처럼 React가 처음이었는데 React 관련 질문이 나한테 들어왔다. 나도 모르는 게 대부분이었기 때문에 문제가 생기면 찾아보고 문서화해서 정리했다.
      이후에 생긴 문제들도 해결되면 일단 정리해서 공유했다
            

## 협업 관리

- [이슈 관리 / JIRA](https://ssafy.atlassian.net/jira/software/c/projects/S08P12A804/boards/1352)
- [협업 문서 / Notion](https://www.notion.so/A804-5eb95295124a44c181f43c22750be9c2?pvs=21)